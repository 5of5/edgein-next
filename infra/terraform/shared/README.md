This Terraform configuration provides infrastructure resources and manages the provisioning of various parameters and certificates required for a project named "nextjs-template". It is designed to be used with the AWS provider.

## Resources

The configuration sets up the following resources:

### AWS ACM Certificate

The configuration creates an ACM (Amazon Certificate Manager) certificate named "root" with the specified domain name and subject alternative names. This certificate is used for securing HTTPS communication.

### AWS S3 Backend

The configuration sets up an S3 backend to store the Terraform state file. It uses a specific S3 bucket, DynamoDB table, and KMS key for encryption. The state file is stored in the `nextjs-template/shared.tfstate` path.

### AWS Route 53 Zone

The Terraform configuration introduces a Route 53 Hosted Zone. After creating the hosted zone, you can create records in the hosted zone to tell Route 53 how you want to route traffic for that domain.

Please ensure to handle the NS and SOA records generated by this hosted zone, as they must be correctly set up in your registrar for your domain to resolve correctly. The DNS settings can be managed in the Route 53 console or through additional Terraform resource blocks.

Here is a simple guide for buying and creating a new zone.

**Step 1: Purchase a Domain Name**

Before setting up a Hosted Zone, you first need to have a domain name. You can purchase one directly from AWS or any other domain name registrar of your choice.

If you decide to purchase it from AWS, follow these steps:

1. Navigate to the AWS Management Console and open the Route53 service.
2. Click on "Domain Registration".
3. Click on "Register Domain".
4. Enter your desired domain name and choose your top-level domain (e.g., .com, .org, .net, etc.).
5. Follow the prompts to complete the domain registration process, including payment.

**Step 2: Create a Hosted Zone**

Once you have a domain name, you can create a Hosted Zone in Route53. Follow these steps:

1. Navigate to the AWS Management Console and open the Route53 service.
2. Click on "Hosted zones" in the left-side navigation.
3. Click on "Create hosted zone".
4. Enter your domain name in the "Domain Name" field.
5. For the "Type", select "Public Hosted Zone".
6. Click "Create hosted zone".

At this point, Route53 generates four name servers, each with a unique URL, which you will use to direct your domain to your AWS resources.

**Step 3: Update Name Servers**

If you purchased your domain name from AWS, the name servers should automatically be associated with your domain. If not, you need to manually update the name servers at your domain registrar.

1. Navigate to your domain registrar and locate the area where you can update your name servers.
2. Replace the existing name servers with the four provided by Route53.
3. Save your changes.

Please note that DNS changes can take up to 48 hours to propagate globally.

That's it! You've now successfully set up a new Hosted Zone on AWS Route53. You can now proceed to configure DNS records for your Next.js application.

### AWS SSM Parameters

Several AWS Systems Manager (SSM) parameters are created to store sensitive information securely. These parameters are used for setting environment variables in Fargate tasks and configuring various components of the infrastructure. The parameters include:

- `smtp_user`: Stores the SMTP user for Fargate tasks.
- `smtp_host`: Stores the SMTP host for Fargate tasks.
- `smtp_password`: Stores the SMTP password for Fargate tasks.
- `smtp_port`: Stores the SMTP port for Fargate tasks.
- `email_from`: Stores the email address used as the sender in Fargate tasks.
- `db_name`: Stores the name of the database in Amazon RDS.
- `db_username`: Stores the username for the root account in Amazon RDS.
- `sentry_dsn`: Stores the DSN (Data Source Name) for Sentry error tracking.

### AWS Provider Configuration

The configuration sets up the AWS provider with the specified region and default tags. The default tags include the "Project" tag with the value of the project name ("nextjs-template") and the "Workspace" tag with the value "shared".

## Variables

The configuration defines several input variables that can be customized to suit your specific environment. The variables and their descriptions are as follows:

- `region`: The AWS region where the infrastructure resources will be provisioned. Default: `eu-central-1`.
- `project`: The name of the project. Default: `nextjs-template`.
- `domain_name`: The domain name used for the ACM certificate. Default: `nextjs-template.sudolabs.com`.
- `smtp_user`: The SMTP user for Fargate tasks. Default: `apikey`.
- `smtp_password`: The SMTP password for Fargate tasks.
- `smtp_host`: The SMTP host for Fargate tasks.
- `smtp_port`: The SMTP port for Fargate tasks. Default: `587`.
- `email_from`: The email address used as the sender in Fargate tasks.
- `db_name`: The name of the database in Amazon RDS. Default: `nextjs-template`.
- `db_username`: The username for the root account in Amazon RDS. Default: `root`.
- `sentry_dsn`: The DSN (Data Source Name) for Sentry error tracking.

## Outputs

The configuration provides the following outputs:

- `certificate_arn`: The ARN (Amazon Resource Name) of the ACM certificate.
- `domain_name`: The fully qualified domain name.
- `smtp_user`: The name of the `smtp_user` SSM parameter.
- `smtp_password`: The name of the `smtp_password` SSM parameter.
- `smtp_host`: The name of the `smtp_host` SSM parameter.
- `smtp_port`: The name of the `smtp_port` SSM parameter.
- `email_from`: The name of the `email_from` SSM parameter.
- `db_name`: The name of the `db_name`
